<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting Started &mdash; Cassandra Driver 1.0.0b7.post documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0b7.post',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Cassandra Driver 1.0.0b7.post documentation" href="../index.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Cassandra Driver 1.0.0b7.post documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Getting Started</a><ul>
<li><a class="reference internal" href="#connecting-to-cassandra">Connecting to Cassandra</a></li>
<li><a class="reference internal" href="#executing-queries">Executing Queries</a><ul>
<li><a class="reference internal" href="#passing-parameters-to-cql-queries">Passing Parameters to CQL Queries</a></li>
<li><a class="reference internal" href="#type-conversions">Type Conversions</a></li>
<li><a class="reference internal" href="#asynchronous-queries">Asynchronous Queries</a></li>
<li><a class="reference internal" href="#setting-a-consistency-level">Setting a Consistency Level</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prepared-statements">Prepared Statements</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/api/getting_started.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>First, make sure you have the driver properly <a class="reference internal" href="installation.html"><em>installed</em></a>.</p>
<div class="section" id="connecting-to-cassandra">
<h2>Connecting to Cassandra<a class="headerlink" href="#connecting-to-cassandra" title="Permalink to this headline">¶</a></h2>
<p>Before we can start executing any queries against Cassandra we need to setup
our <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><tt class="xref py py-class docutils literal"><span class="pre">Cluster</span></tt></a>. As the name suggests, you will typically have one
instance of <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><tt class="xref py py-class docutils literal"><span class="pre">Cluster</span></tt></a> for each Cassandra cluster you want to interact
with.</p>
<p>The simplest way to create a <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><tt class="xref py py-class docutils literal"><span class="pre">Cluster</span></tt></a> is like this</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">([</span><span class="s">&#39;10.1.1.3&#39;</span><span class="p">,</span> <span class="s">&#39;10.1.1.4&#39;</span><span class="p">,</span> <span class="s">&#39;10.1.1.5&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The set of IP addresses we pass to the <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><tt class="xref py py-class docutils literal"><span class="pre">Cluster</span></tt></a> are simply
an initial set of contact points.  After the driver connects to one
of these addresses it will automatically discover the rest of the
nodes in the cluster and connect to them, so you don&#8217;t need to list
every node in your cluster.</p>
<p>If you need to use a non-standard port, use SSL, or customize the driver&#8217;s
behavior in some other way, this is the place to do it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>
<span class="kn">from</span> <span class="nn">cassandra.polices</span> <span class="kn">import</span> <span class="n">DCAwareRoundRobinPolicy</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span>
    <span class="n">contact_points</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;10.1.1.3&#39;</span><span class="p">,</span> <span class="s">&#39;10.1.1.4&#39;</span><span class="p">,</span> <span class="s">&#39;10.1.1.5&#39;</span><span class="p">],</span>
    <span class="n">load_balancing_policy</span><span class="o">=</span><span class="n">DCAwareRoundRobinPolicy</span><span class="p">(</span><span class="n">local_dc</span><span class="o">=</span><span class="s">&#39;US_EAST&#39;</span><span class="p">),</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">9042</span><span class="p">)</span>
</pre></div>
</div>
<p>You can find a more complete list of options in the <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><tt class="xref py py-class docutils literal"><span class="pre">Cluster</span></tt></a> documentation.</p>
<p>Instantiating a <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><tt class="xref py py-class docutils literal"><span class="pre">Cluster</span></tt></a> does not actually connect us to any nodes.
To establish connections and begin executing queries we need a
<a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Session" title="cassandra.cluster.Session"><tt class="xref py py-class docutils literal"><span class="pre">Session</span></tt></a>, which is created by calling <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Cluster.connect" title="cassandra.cluster.Cluster.connect"><tt class="xref py py-meth docutils literal"><span class="pre">Cluster.connect()</span></tt></a>.
The <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Cluster.connect" title="cassandra.cluster.Cluster.connect"><tt class="xref py py-meth docutils literal"><span class="pre">connect()</span></tt></a> method takes an optional <tt class="docutils literal"><span class="pre">keyspace</span></tt> argument
which sets the default keyspace for all queries made through that <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Session" title="cassandra.cluster.Session"><tt class="xref py py-class docutils literal"><span class="pre">Session</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">([</span><span class="s">&#39;10.1.1.3&#39;</span><span class="p">,</span> <span class="s">&#39;10.1.1.4&#39;</span><span class="p">,</span> <span class="s">&#39;10.1.1.5&#39;</span><span class="p">])</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;mykeyspace&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can always change a Sesssion&#8217;s keyspace using <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Session.set_keyspace" title="cassandra.cluster.Session.set_keyspace"><tt class="xref py py-meth docutils literal"><span class="pre">set_keyspace()</span></tt></a> or
by executing a <tt class="docutils literal"><span class="pre">USE</span> <span class="pre">&lt;keyspace&gt;</span></tt> query:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">session</span><span class="o">.</span><span class="n">set_keyspace</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">)</span>
<span class="c"># or you can do this instead</span>
<span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;USE users&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="executing-queries">
<h2>Executing Queries<a class="headerlink" href="#executing-queries" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Session" title="cassandra.cluster.Session"><tt class="xref py py-class docutils literal"><span class="pre">Session</span></tt></a> we can begin to execute queries. The most
basic and natural way to execute a query is to use <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Session.execute" title="cassandra.cluster.Session.execute"><tt class="xref py py-meth docutils literal"><span class="pre">execute()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">rows</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SELECT name, age, email FROM users&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">user_row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">user_row</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">user_row</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">user_row</span><span class="o">.</span><span class="n">email</span>
</pre></div>
</div>
<p>This will transparently pick a Cassandra node to execute the query against
and handle any retries that are necessary if the operation fails.</p>
<p>By default, each row in the result set will be a
<a class="reference external" href="http://docs.python.org/2/library/collections.html#collections.namedtuple">namedtuple</a>.
Each row will have a matching attribute for each column defined in the schema,
such as <tt class="docutils literal"><span class="pre">name</span></tt>, <tt class="docutils literal"><span class="pre">age</span></tt>, and so on.  You can also treat them as normal tuples
by unpacking them or accessing fields by position:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">rows</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SELECT name, age, email FROM users&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">email</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">rows</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SELECT name, age, email FROM users&#39;</span><span class="p">)</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
<span class="n">ages</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
<span class="n">emails</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
</pre></div>
</div>
<p>If you prefer another result format, such as a <tt class="docutils literal"><span class="pre">dict</span></tt> per row, you
can change the <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Session.row_factory" title="cassandra.cluster.Session.row_factory"><tt class="xref py py-attr docutils literal"><span class="pre">row_factory</span></tt></a> attribute.</p>
<div class="section" id="passing-parameters-to-cql-queries">
<h3>Passing Parameters to CQL Queries<a class="headerlink" href="#passing-parameters-to-cql-queries" title="Permalink to this headline">¶</a></h3>
<p>When executing non-prepared statements, the driver supports two forms of
parameter place-holders: positional and named.</p>
<p>Positional parameters are used with a <tt class="docutils literal"><span class="pre">%s</span></tt> placeholder.  For example,
when you execute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INSERT INTO users (name, credits, user_id)</span>
<span class="sd">    VALUES (%s, %s, %s)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="s">&quot;John O&#39;Reilly&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>
<span class="p">)</span>
</pre></div>
</div>
<p>It is translated to the following CQL query:</p>
<div class="highlight-SQL"><pre>INSERT INTO users (name, credits, user_id)
VALUES ('John O''Reilly', 42, 2644bada-852c-11e3-89fb-e0b9a54a6d93)</pre>
</div>
<p>Note that you should use <tt class="docutils literal"><span class="pre">%s</span></tt> for all types of arguments, not just strings.
For example, this would be <strong>wrong</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;INSERT INTO USERS (name, age) VALUES (</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;bob&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">))</span>  <span class="c"># wrong</span>
</pre></div>
</div>
<p>Instead, use <tt class="docutils literal"><span class="pre">%s</span></tt> for the age placeholder.</p>
<p>If you need to use a literal <tt class="docutils literal"><span class="pre">%</span></tt> character, use <tt class="docutils literal"><span class="pre">%%</span></tt>.</p>
<p><strong>Note</strong>: you must always use a sequence for the second argument, even if you are
only passing in a single variable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;INSERT INTO foo (bar) VALUES (</span><span class="si">%s</span><span class="s">)&quot;</span><span class="p">,</span> <span class="s">&quot;blah&quot;</span><span class="p">)</span>  <span class="c"># wrong</span>
<span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;INSERT INTO foo (bar) VALUES (</span><span class="si">%s</span><span class="s">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;blah&quot;</span><span class="p">))</span>  <span class="c"># wrong</span>
<span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;INSERT INTO foo (bar) VALUES (</span><span class="si">%s</span><span class="s">)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;blah&quot;</span><span class="p">,</span> <span class="p">))</span>  <span class="c"># right</span>
<span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;INSERT INTO foo (bar) VALUES (</span><span class="si">%s</span><span class="s">)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;blah&quot;</span><span class="p">])</span>  <span class="c"># right</span>
</pre></div>
</div>
<p>Note that the second line is incorrect because in Python, single-element tuples
require a comma.</p>
<p>Named place-holders use the <tt class="docutils literal"><span class="pre">%(name)s</span></tt> form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INSERT INTO users (name, credits, user_id, username)</span>
<span class="sd">    VALUES (%(name)s, %(credits)s, %(user_id)s, %(name)s)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&quot;John O&#39;Reilly&quot;</span><span class="p">,</span> <span class="s">&#39;credits&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">()}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that you can repeat placeholders with the same name, such as <tt class="docutils literal"><span class="pre">%(name)s</span></tt>
in the above example.</p>
<p>Only data values should be supplied this way.  Other items, such as keyspaces,
table names, and column names should be set ahead of time (typically using
normal string formatting).</p>
</div>
<div class="section" id="type-conversions">
<h3>Type Conversions<a class="headerlink" href="#type-conversions" title="Permalink to this headline">¶</a></h3>
<p>For non-prepared statements, Python types are cast to CQL literals in the
following way:</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Python Type</th>
<th class="head">CQL Literal Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">None</span></tt></td>
<td><tt class="docutils literal"><span class="pre">NULL</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">bool</span></tt></td>
<td><tt class="docutils literal"><span class="pre">bool</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">float</span></tt></td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">float</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">double</span></tt></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">int</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">long</span></tt></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">int</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">bigint</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">varint</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">counter</span></tt></div>
</div>
</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">decimal.Decimal</span></tt></td>
<td><tt class="docutils literal"><span class="pre">decimal</span></tt></td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">str</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">unicode</span></tt></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">ascii</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">varchar</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">text</span></tt></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">buffer</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">bytearray</span></tt></div>
</div>
</td>
<td><tt class="docutils literal"><span class="pre">blob</span></tt></td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">date</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">datetime</span></tt></div>
</div>
</td>
<td><tt class="docutils literal"><span class="pre">timestamp</span></tt></td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">list</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">tuple</span></tt></div>
<div class="line">generator</div>
</div>
</td>
<td><tt class="docutils literal"><span class="pre">list</span></tt></td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">set</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">frozenset</span></tt></div>
</div>
</td>
<td><tt class="docutils literal"><span class="pre">set</span></tt></td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">dict</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">OrderedDict</span></tt></div>
</div>
</td>
<td><tt class="docutils literal"><span class="pre">map</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">uuid.UUID</span></tt></td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">timeuuid</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">uuid</span></tt></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="asynchronous-queries">
<h3>Asynchronous Queries<a class="headerlink" href="#asynchronous-queries" title="Permalink to this headline">¶</a></h3>
<p>The driver supports asynchronous query execution through
<a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Session.execute_async" title="cassandra.cluster.Session.execute_async"><tt class="xref py py-meth docutils literal"><span class="pre">execute_async()</span></tt></a>.  Instead of waiting for the query to
complete and returning rows directly, this method almost immediately
returns a <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.ResponseFuture" title="cassandra.cluster.ResponseFuture"><tt class="xref py py-class docutils literal"><span class="pre">ResponseFuture</span></tt></a> object.  There are two ways of
getting the final result from this object.</p>
<p>The first is by calling <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.ResponseFuture.result" title="cassandra.cluster.ResponseFuture.result"><tt class="xref py py-meth docutils literal"><span class="pre">result()</span></tt></a> on it. If
the query has not yet completed, this will block until it has and
then return the result or raise an Exception if an error occurred.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cassandra</span> <span class="kn">import</span> <span class="n">ReadTimeout</span>

<span class="n">query</span> <span class="o">=</span> <span class="s">&quot;SELECT * FROM users WHERE user_id=</span><span class="si">%s</span><span class="s">&quot;</span>
<span class="n">future</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">[</span><span class="n">user_id</span><span class="p">])</span>

<span class="c"># ... do some other work</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">age</span>
<span class="k">except</span> <span class="n">ReadTimeout</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s">&quot;Query timed out:&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This works well for executing many queries concurrently:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># build a list of futures</span>
<span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">query</span> <span class="o">=</span> <span class="s">&quot;SELECT * FROM users WHERE user_id=</span><span class="si">%s</span><span class="s">&quot;</span>
<span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">ids_to_fetch</span><span class="p">:</span>
    <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">[</span><span class="n">user_id</span><span class="p">])</span>

<span class="c"># wait for them to complete and use the results</span>
<span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">:</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>Alternatively, instead of calling <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.ResponseFuture.result" title="cassandra.cluster.ResponseFuture.result"><tt class="xref py py-meth docutils literal"><span class="pre">result()</span></tt></a>,
you can attach callback and errback functions through the
<a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.ResponseFuture.add_callback" title="cassandra.cluster.ResponseFuture.add_callback"><tt class="xref py py-meth docutils literal"><span class="pre">add_callback()</span></tt></a>,
<a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.ResponseFuture.add_errback" title="cassandra.cluster.ResponseFuture.add_errback"><tt class="xref py py-meth docutils literal"><span class="pre">add_errback()</span></tt></a>, and
<a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.ResponseFuture.add_callbacks" title="cassandra.cluster.ResponseFuture.add_callbacks"><tt class="xref py py-meth docutils literal"><span class="pre">add_callbacks()</span></tt></a>, methods.  If you have used
Twisted Python before, this is designed to be a lightweight version of
that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">handle_success</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">process_user</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Failed to process user </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c"># don&#39;t re-raise errors in the callback</span>

<span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Failed to fetch user info: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span>


<span class="n">future</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">future</span><span class="o">.</span><span class="n">add_callbacks</span><span class="p">(</span><span class="n">handle_success</span><span class="p">,</span> <span class="n">handle_error</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>There are a few important things to remember when working with callbacks:</dt>
<dd><ul class="first last simple">
<li><strong>Exceptions that are raised inside the callback functions will be logged and then ignored.</strong></li>
<li>Your callback will be run on the event loop thread, so any long-running
operations will prevent other requests from being handled</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="setting-a-consistency-level">
<h3>Setting a Consistency Level<a class="headerlink" href="#setting-a-consistency-level" title="Permalink to this headline">¶</a></h3>
<p>The consistency level used for a query determines how many of the
replicas of the data you are interacting with need to respond for
the query to be considered a success.</p>
<p>By default, <a class="reference internal" href="cassandra.html#cassandra.ConsistencyLevel.ONE" title="cassandra.ConsistencyLevel.ONE"><tt class="xref py py-attr docutils literal"><span class="pre">ConsistencyLevel.ONE</span></tt></a> will be used for all queries. To
specify a different consistency level, you will need to wrap your queries
in a <a class="reference internal" href="cassandra/query.html#cassandra.query.SimpleStatement" title="cassandra.query.SimpleStatement"><tt class="xref py py-class docutils literal"><span class="pre">SimpleStatement</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cassandra</span> <span class="kn">import</span> <span class="n">ConsistencyLevel</span>
<span class="kn">from</span> <span class="nn">cassandra.query</span> <span class="kn">import</span> <span class="n">SimpleStatement</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">SimpleStatement</span><span class="p">(</span>
    <span class="s">&quot;INSERT INTO users (name, age) VALUES (</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&quot;</span><span class="p">,</span>
    <span class="n">consistency_level</span><span class="o">=</span><span class="n">ConsistencyLevel</span><span class="o">.</span><span class="n">QUORUM</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;John&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="prepared-statements">
<h2>Prepared Statements<a class="headerlink" href="#prepared-statements" title="Permalink to this headline">¶</a></h2>
<p>Prepared statements are queries that are parsed by Cassandra and then saved
for later use.  When the driver uses a prepared statement, it only needs to
send the values of parameters to bind.  This lowers network traffic
and CPU utilization within Cassandra because Cassandra does not have to
re-parse the query each time.</p>
<p>To prepare a query, use <a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Session.prepare" title="cassandra.cluster.Session.prepare"><tt class="xref py py-meth docutils literal"><span class="pre">Session.prepare()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">user_lookup_stmt</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s">&quot;SELECT * FROM users WHERE user_id=?&quot;</span><span class="p">)</span>

<span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">user_ids_to_query</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">user_lookup_stmt</span><span class="p">,</span> <span class="p">[</span><span class="n">user_id</span><span class="p">])</span>
    <span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="cassandra/cluster.html#cassandra.cluster.Session.prepare" title="cassandra.cluster.Session.prepare"><tt class="xref py py-meth docutils literal"><span class="pre">prepare()</span></tt></a> returns a <a class="reference internal" href="cassandra/query.html#cassandra.query.PreparedStatement" title="cassandra.query.PreparedStatement"><tt class="xref py py-class docutils literal"><span class="pre">PreparedStatement</span></tt></a> instance
which can be used in place of <a class="reference internal" href="cassandra/query.html#cassandra.query.SimpleStatement" title="cassandra.query.SimpleStatement"><tt class="xref py py-class docutils literal"><span class="pre">SimpleStatement</span></tt></a> instances or literal
string queries.  It is automatically prepared against all nodes, and the driver
handles re-preparing against new nodes and restarted nodes when necessary.</p>
<p>Note that the placeholders for prepared statements are <tt class="docutils literal"><span class="pre">?</span></tt> characters.  This
is different than for simple, non-prepared statements (although future versions
of the driver may use the same placeholders for both).  Cassandra 2.0 added
support for named placeholders; the 1.0 version of the driver does not support
them, but the 2.0 version will.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li><a href="../index.html">Cassandra Driver 1.0.0b7.post documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, DataStax.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>